# Zephyr Usage Examples

This document provides comprehensive usage examples for all Zephyr commands with real-world scenarios and expected outputs.

## Table of Contents

- [Command Overview](#command-overview)
- [zephyr load](#zephyr-load)
- [zephyr list](#zephyr-list)
- [zephyr validate](#zephyr-validate)
- [zephyr init](#zephyr-init)
- [Environment Variables](#environment-variables)
- [Integration Examples](#integration-examples)
- [Advanced Workflows](#advanced-workflows)

## Command Overview

Zephyr provides four main commands:

| Command | Purpose | Usage |
|---------|---------|-------|
| `load` | Generate shell code for loading modules (default) | `zephyr load` |
| `list` | Show discovered modules and load order | `zephyr list` |
| `validate` | Validate module manifests | `zephyr validate` |
| `init` | Create new module skeleton | `zephyr init <name>` |

## zephyr load

The `load` command is the primary command that generates shell code for loading all discovered modules in dependency order.

### Basic Usage

```bash
# Generate shell code (most common usage)
eval "$(zephyr load)"

# Just see what would be generated without executing
zephyr load

# Alternative if zephyr is in PATH
eval "$(zephyr)"
```

### Example Output

Given modules in `$HOME/.zsh/modules/`:
- `core/` (priority: 10)
- `colors/` (priority: 20, depends on core)
- `git-helpers/` (priority: 50, depends on core, colors)

**Command:**
```bash
zephyr load
```

**Output:**
```bash
# Generated by Zephyr Shell Loader
# https://github.com/xDarkicex/zephyr
# Generated: 2024-01-15 14:30:22

# === Module: core v1.0.0 ===
export ZSH_MODULE_CORE_THEME="default"
export ZSH_MODULE_CORE_AUTO_UPDATE="true"
source "$HOME/.zsh/modules/core/exports.zsh"
source "$HOME/.zsh/modules/core/functions.zsh"

# === Module: colors v1.1.0 ===
export ZSH_MODULE_COLORS_SCHEME="dark"
typeset -f colors_init >/dev/null 2>&1 && colors_init
source "$HOME/.zsh/modules/colors/colors.zsh"
typeset -f colors_ready >/dev/null 2>&1 && colors_ready

# === Module: git-helpers v2.0.1 ===
export ZSH_MODULE_GIT_HELPERS_DEFAULT_BRANCH="main"
export ZSH_MODULE_GIT_HELPERS_AUTO_FETCH="true"
typeset -f git_check_version >/dev/null 2>&1 && git_check_version
source "$HOME/.zsh/modules/git-helpers/git-aliases.zsh"
source "$HOME/.zsh/modules/git-helpers/git-functions.zsh"
typeset -f git_setup_completion >/dev/null 2>&1 && git_setup_completion
```

### Integration in .zshrc

**Basic integration:**
```bash
# Add to ~/.zshrc
eval "$($HOME/.zsh/bin/zephyr load)"
```

**With PATH setup:**
```bash
# Add to ~/.zshrc
export PATH="$HOME/.zsh/bin:$PATH"
eval "$(zephyr load)"
```

**With error handling:**
```bash
# Add to ~/.zshrc
if command -v zephyr >/dev/null 2>&1; then
    eval "$(zephyr load)"
else
    echo "Warning: Zephyr not found, skipping module loading"
fi
```

**With custom modules directory:**
```bash
# Add to ~/.zshrc
export ZSH_MODULES_DIR="$HOME/dotfiles/zsh-modules"
eval "$(zephyr load)"
```

### Error Scenarios

**No modules found:**
```bash
$ zephyr load
No modules found in: /Users/john/.zsh/modules
```

**Missing dependency:**
```bash
$ zephyr load
ERROR: Missing dependency: 'git-helpers' requires 'colors'
```

**Circular dependency:**
```bash
$ zephyr load
ERROR: Circular dependency detected
```

## zephyr list

The `list` command shows all discovered modules and their resolved load order.

### Basic Usage

```bash
zephyr list
```

### Example Output

**With simple modules:**
```bash
$ zephyr list
Resolved load order:

  1. core [priority: 10]

  2. my-aliases [priority: 100]

  3. git-helpers [priority: 50]
     └─ depends on: ["core"]
```

**With complex dependencies:**
```bash
$ zephyr list
Resolved load order:

  1. core [priority: 10]

  2. colors [priority: 20]
     └─ depends on: ["core"]

  3. utils [priority: 30]
     └─ depends on: ["core"]

  4. git-helpers [priority: 50]
     └─ depends on: ["core", "colors"]

  5. docker-tools [priority: 60]
     └─ depends on: ["core", "utils"]

  6. my-aliases [priority: 100]

  7. local-config [priority: 200]
     └─ depends on: ["git-helpers"]
```

**With optional dependencies:**
```bash
$ zephyr list
Resolved load order:

  1. core [priority: 10]

  2. fzf-integration [priority: 40]
     └─ depends on: ["core"]

  3. git-helpers [priority: 50]
     └─ depends on: ["core"]
     └─ optional: ["fzf-integration"] ✓ available
```

### Error Scenarios

**Missing required dependency:**
```bash
$ zephyr list
ERROR: Missing dependency: 'git-helpers' requires 'colors'

Available modules:
  - core
  - git-helpers
  - my-aliases
```

**Circular dependency:**
```bash
$ zephyr list
ERROR: Circular dependency detected

Dependency chain:
  git-helpers → colors → themes → git-helpers
```

## zephyr validate

The `validate` command checks all module manifests for syntax errors and dependency issues.

### Basic Usage

```bash
zephyr validate
```

### Example Output

**All valid:**
```bash
$ zephyr validate
✓ All modules validated successfully

Validated modules:
  - core (v1.0.0)
  - colors (v1.1.0)
  - git-helpers (v2.0.1)
  - my-aliases (v1.0.0)
```

**With errors:**
```bash
$ zephyr validate
✗ Validation failed:

Manifest errors:
  - git-helpers/module.toml: Missing required dependency 'colors'
  - my-broken-module/module.toml: Invalid TOML syntax at line 5
  - old-module/module.toml: Missing required field 'module.name'

File errors:
  - git-helpers/missing-file.zsh: File specified in manifest but not found
  - colors/broken-link.zsh: File is not readable

Summary: 3 modules with errors, 2 modules valid
```

**With warnings:**
```bash
$ zephyr validate
⚠ Validation completed with warnings:

Warnings:
  - git-helpers/module.toml: Optional dependency 'fzf' not found
  - my-aliases/module.toml: No version specified, using default '0.0.0'
  - utils/module.toml: Priority not specified, using default 100

✓ All modules are loadable despite warnings

Summary: 4 modules valid, 3 warnings
```

### Detailed Validation

**Verbose output (if implemented):**
```bash
$ zephyr validate --verbose
Scanning modules directory: /Users/john/.zsh/modules

Found modules:
  ✓ core/module.toml
  ✓ colors/module.toml
  ✓ git-helpers/module.toml
  ✗ broken-module/module.toml

Validating core:
  ✓ Required fields present
  ✓ Version format valid (1.0.0)
  ✓ Files exist: exports.zsh, functions.zsh
  ✓ No dependencies to check

Validating colors:
  ✓ Required fields present
  ✓ Version format valid (1.1.0)
  ✓ Dependencies satisfied: core ✓
  ✓ Files exist: colors.zsh
  ✓ Hooks defined: colors_init, colors_ready

Validating git-helpers:
  ✓ Required fields present
  ✓ Version format valid (2.0.1)
  ✓ Dependencies satisfied: core ✓, colors ✓
  ✓ Files exist: git-aliases.zsh, git-functions.zsh
  ✓ Platform compatibility: current platform matches

Validating broken-module:
  ✗ TOML parse error: expected '=' after key at line 3
```

## zephyr init

The `init` command creates a new module skeleton with boilerplate files.

### Basic Usage

```bash
zephyr init <module-name>
```

### Examples

**Create simple module:**
```bash
$ zephyr init my-aliases
✓ Created module: my-aliases

Generated files:
  /Users/john/.zsh/modules/my-aliases/
  ├── module.toml
  ├── init.zsh
  ├── aliases.zsh
  ├── functions.zsh
  └── README.md

Next steps:
  1. Edit module.toml to configure your module
  2. Add your aliases to aliases.zsh
  3. Add your functions to functions.zsh
  4. Test with: zephyr validate
```

**Create module with custom directory:**
```bash
$ export ZSH_MODULES_DIR="/path/to/custom/modules"
$ zephyr init git-workflow
✓ Created module: git-workflow

Generated files:
  /path/to/custom/modules/git-workflow/
  ├── module.toml
  ├── init.zsh
  ├── aliases.zsh
  ├── functions.zsh
  └── README.md
```

### Generated Files

**module.toml:**
```toml
[module]
name = "my-aliases"
version = "1.0.0"
description = "My custom shell aliases and functions"
author = "Your Name <your.email@example.com>"
license = "MIT"

[dependencies]
# required = ["core"]
# optional = ["colors"]

[load]
priority = 100
files = ["init.zsh"]

# [hooks]
# pre_load = "setup_function"
# post_load = "cleanup_function"

# [settings]
# theme = "default"
# auto_update = "true"
```

**init.zsh:**
```bash
#!/usr/bin/env zsh
# my-aliases module initialization

# Source other module files
source "${0:A:h}/aliases.zsh"
source "${0:A:h}/functions.zsh"

# Module initialization code here
echo "my-aliases module loaded"
```

**aliases.zsh:**
```bash
#!/usr/bin/env zsh
# my-aliases: Shell aliases

# Add your aliases here
# alias ll='ls -la'
# alias la='ls -A'
# alias l='ls -CF'
```

**functions.zsh:**
```bash
#!/usr/bin/env zsh
# my-aliases: Shell functions

# Add your functions here
# example_function() {
#     echo "Hello from my-aliases module!"
# }
```

**README.md:**
```markdown
# my-aliases

My custom shell aliases and functions

## Description

Add a description of what this module does.

## Installation

This module is automatically discovered by Zephyr when placed in your modules directory.

## Usage

Add usage examples here.

## Configuration

Document any settings or configuration options.

## Dependencies

List any module dependencies here.
```

### Error Scenarios

**Module already exists:**
```bash
$ zephyr init core
✗ Error: Module 'core' already exists at /Users/john/.zsh/modules/core
Use a different name or remove the existing module first.
```

**Invalid module name:**
```bash
$ zephyr init "invalid name with spaces"
✗ Error: Invalid module name 'invalid name with spaces'
Module names should use kebab-case (e.g., 'my-module')
```

**Permission denied:**
```bash
$ zephyr init test-module
✗ Error: Cannot create module directory
Permission denied: /Users/john/.zsh/modules/test-module
```

## Environment Variables

### ZSH_MODULES_DIR

Override the default modules directory:

```bash
# Use custom modules directory
export ZSH_MODULES_DIR="$HOME/dotfiles/shell-modules"
zephyr list
```

**Example with multiple directories (future feature):**
```bash
# Search multiple directories
export ZSH_MODULES_DIR="$HOME/.zsh/modules:$HOME/work/modules:/opt/zsh-modules"
zephyr list
```

### Module Settings

Modules can export settings as environment variables:

**In module.toml:**
```toml
[settings]
editor = "nvim"
theme = "dark"
auto_save = "true"
```

**Available in shell:**
```bash
echo $ZSH_MODULE_MYMODULE_EDITOR    # "nvim"
echo $ZSH_MODULE_MYMODULE_THEME     # "dark"
echo $ZSH_MODULE_MYMODULE_AUTO_SAVE # "true"
```

## Integration Examples

### Basic .zshrc Integration

```bash
# ~/.zshrc

# Zephyr module loading
if [[ -x "$HOME/.zsh/bin/zephyr" ]]; then
    eval "$($HOME/.zsh/bin/zephyr load)"
fi

# Your other zsh configuration...
```

### Advanced .zshrc Integration

```bash
# ~/.zshrc

# Set custom modules directory
export ZSH_MODULES_DIR="$HOME/dotfiles/zsh-modules"

# Add zephyr to PATH
export PATH="$HOME/.zsh/bin:$PATH"

# Load modules with error handling
if command -v zephyr >/dev/null 2>&1; then
    # Validate modules before loading
    if zephyr validate >/dev/null 2>&1; then
        eval "$(zephyr load)"
    else
        echo "Warning: Module validation failed, run 'zephyr validate' to see errors"
        # Load anyway or skip based on preference
        eval "$(zephyr load)"
    fi
else
    echo "Warning: Zephyr not found, install with: git clone ... && ./install.sh"
fi

# Your other configuration...
```

### Conditional Loading

```bash
# ~/.zshrc

# Only load modules in interactive shells
if [[ $- == *i* ]]; then
    eval "$(zephyr load)"
fi

# Or only load in specific environments
if [[ "$TERM_PROGRAM" == "vscode" ]]; then
    export ZSH_MODULES_DIR="$HOME/.zsh/vscode-modules"
elif [[ -n "$SSH_CONNECTION" ]]; then
    export ZSH_MODULES_DIR="$HOME/.zsh/remote-modules"
fi

eval "$(zephyr load)"
```

## Advanced Workflows

### Development Workflow

```bash
# Create new module
zephyr init my-new-feature

# Edit the module
$EDITOR ~/.zsh/modules/my-new-feature/module.toml
$EDITOR ~/.zsh/modules/my-new-feature/init.zsh

# Validate changes
zephyr validate

# Test loading order
zephyr list

# Reload shell to test
exec zsh
```

### Module Testing

```bash
# Test specific module loading
ZSH_MODULES_DIR="/path/to/test/modules" zephyr list

# Validate before committing
zephyr validate || exit 1

# Check load order
zephyr list | grep "my-module"
```

### Debugging

```bash
# See what would be loaded
zephyr load > /tmp/zephyr-output.sh
cat /tmp/zephyr-output.sh

# Check module discovery
zephyr list

# Validate all modules
zephyr validate

# Test with different modules directory
ZSH_MODULES_DIR="/tmp/test-modules" zephyr list
```

### Backup and Restore

```bash
# Backup modules
tar -czf zsh-modules-backup.tar.gz ~/.zsh/modules/

# List modules for documentation
zephyr list > modules-inventory.txt

# Restore modules
tar -xzf zsh-modules-backup.tar.gz -C ~/

# Verify after restore
zephyr validate
```

### Performance Testing

```bash
# Time module loading
time eval "$(zephyr load)"

# Profile with many modules
for i in {1..50}; do
    zephyr init "test-module-$i"
done
time zephyr list
time zephyr load >/dev/null
```

This comprehensive usage guide covers all Zephyr commands with practical examples and real-world scenarios.